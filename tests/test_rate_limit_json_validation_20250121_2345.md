# Тест исправлений Rate Limit и валидации JSON

**Дата создания:** 2025-08-24 11:45 (UTC+07)

## Цель тестирования
Проверить корректность работы исправлений для:
1. Обработки HTTP 429 (Rate Limit) с exponential backoff
2. Улучшенной валидации JSON Schema
3. Детальной валидации полей контактов

## Тестовые сценарии

### 1. Тест обработки Rate Limit (HTTP 429)

**Описание:** Проверка корректной обработки ошибки rate limit от Groq API

**Шаги:**
1. Инициализировать LLMExtractor с Groq провайдером
2. Симулировать HTTP 429 ответ с заголовком Retry-After
3. Проверить, что система корректно извлекает время ожидания
4. Убедиться, что применяется exponential backoff

**Ожидаемый результат:**
- Система должна корректно парсить время ожидания из ошибки
- Должна применяться экспоненциальная задержка (до 300 секунд максимум)
- После задержки должна быть повторная попытка запроса

### 2. Тест улучшенной валидации JSON

**Описание:** Проверка новой логики валидации JSON ответов от LLM

**Тестовые данные:**
```json
{
  "contacts": [
    {
      "name": "Иван Петров",
      "email": "ivan@example.com",
      "phone": "+7-123-456-7890",
      "organization": "ООО Тест",
      "position": "Менеджер",
      "city": "Москва",
      "confidence": 0.95
    },
    {
      "name": "Некорректный контакт",
      "email": "invalid-email",
      "phone": "123",
      "confidence": "не число"
    }
  ]
}
```

**Ожидаемый результат:**
- Валидный контакт должен пройти проверку
- Невалидный контакт должен быть отфильтрован
- Отсутствующие поля должны заполняться пустыми значениями

### 3. Тест валидации email и телефонов

**Описание:** Проверка методов `_is_valid_email` и `_is_valid_phone`

**Тестовые случаи для email:**
- ✅ `test@example.com` - валидный
- ✅ `user.name+tag@domain.co.uk` - валидный
- ❌ `invalid-email` - невалидный
- ❌ `@domain.com` - невалидный
- ❌ `test@` - невалидный

**Тестовые случаи для телефонов:**
- ✅ `+7-123-456-7890` - валидный
- ✅ `8 (495) 123-45-67` - валидный
- ✅ `+1234567890` - валидный
- ❌ `123` - невалидный (слишком короткий)
- ❌ `abc-def-ghij` - невалидный (буквы)

## Результаты тестирования

### Статус: В ожидании выполнения

**Примечания:**
- Тесты должны выполняться в изолированной среде
- Для тестирования rate limit можно использовать mock объекты
- Валидация должна работать независимо от провайдера LLM

---
**Создано:** 2025-01-21 23:45 (UTC+07)  
**Статус:** Готов к выполнению
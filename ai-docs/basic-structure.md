# Базовая структура проекта Contact Parser

## Обзор

Contact Parser - это система автоматической обработки email-писем с извлечением контактной информации и анализа коммерческих предложений. Проект использует IMAP для получения писем, OCR для обработки вложений и LLM для анализа содержимого.

## Структура директорий

### `/src` - Основной код
Содержит все Python модули для обработки email, вложений и анализа данных.

### `/config` - Конфигурация
Файлы настроек, фильтры, учетные данные и региональные настройки.

### `/data` - Данные и результаты
- `emails/` - скачанные email сообщения
- `attachments/` - вложения из писем
- `processed/` - обработанные данные
- `final_results/` - финальные результаты анализа
- `logs/` - логи обработки
- `llm_test_results/` - результаты тестирования LLM
- `processing_state/` - состояние обработки

### `/prompts` - Промпты для LLM
Текстовые файлы с инструкциями для анализа email и коммерческих предложений.

### `/archive` - Архив
Исторические данные и результаты предыдущих запусков.

## Основные модули

### `advanced_email_fetcher.py`
Главный модуль для получения email через IMAP:
- Подключение к почтовому серверу
- Фильтрация писем по датам и критериям
- Скачивание вложений с поддержкой форматов (PDF, DOC, XLS, изображения)
- Исключение небезопасных типов файлов
- Логирование процесса

### `attachment_processor.py`
Обработка вложений:
- OCR для изображений и PDF
- Извлечение текста из документов Word/Excel
- Поддержка русского и английского языков
- Обработка только предварительно отфильтрованных файлов

### `integrated_llm_processor.py`
Интеграция всех компонентов:
- Координация обработки email и вложений
- Анализ коммерческих предложений
- Извлечение контактной информации
- Сохранение результатов

### `email_loader.py`
Загрузка и управление обработанными email:
- Чтение сохраненных данных
- Управление путями к файлам
- Валидация данных

### `llm_commercial_tester.py`
Тестирование LLM моделей:
- Проверка качества анализа
- Сравнение результатов разных моделей
- Метрики производительности

## Конфигурация

### `settings.py`
Основные настройки системы:
- IMAP параметры подключения
- Конфигурация LLM провайдеров (OpenRouter, Replicate)
- Google Sheets интеграция
- Региональные приоритеты

### `regions.py`
Региональные настройки:
- Приоритеты по городам
- Географическая классификация контактов

### `processing_config.json`
Параметры обработки:
- Размеры батчей
- Таймауты
- Лимиты запросов

### Фильтры
- `blacklist.txt` - исключенные отправители
- `filters.txt` - правила фильтрации
- `attachment_filename_excludes.txt` - исключенные имена файлов

## Обработка данных

### Поток данных
1. **Получение** - IMAP fetcher скачивает письма и вложения
2. **Фильтрация** - исключение нежелательного контента
3. **Обработка** - OCR и извлечение текста из вложений
4. **Анализ** - LLM анализ содержимого
5. **Сохранение** - результаты в структурированном виде

### Поддерживаемые форматы
- **Документы**: PDF, DOC, DOCX, TXT
- **Таблицы**: XLS, XLSX, XLSM
- **Изображения**: JPG, PNG, GIF, BMP, TIFF, WebP

## Зависимости

### Основные библиотеки
- **Асинхронность**: aiohttp, asyncio
- **OCR**: EasyOCR, PaddleOCR, Tesseract
- **Обработка документов**: PyMuPDF, python-docx, openpyxl
- **Машинное обучение**: PyTorch, scikit-learn
- **LLM интеграция**: LangChain, OpenAI клиенты

### Специализированные
- **Изображения**: OpenCV, Pillow
- **Парсинг**: BeautifulSoup, lxml
- **Данные**: pandas, numpy
- **Сеть**: requests, httpx

## Архитектурные принципы

- **Модульность** - каждый компонент отвечает за свою область
- **Фильтрация** - раннее исключение нежелательного контента
- **Логирование** - детальное отслеживание всех операций
- **Конфигурируемость** - настройки вынесены в отдельные файлы
- **Обработка ошибок** - устойчивость к сбоям и повторные попытки

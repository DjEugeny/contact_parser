# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ "list index out of range"

**–î–∞—Ç–∞:** 2025-01-27 02:45 (UTC+07)  
**–¢–∏–ø:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –ø–∏—Å–µ–º (>16K —Å–∏–º–≤–æ–ª–æ–≤) –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ "list index out of range" –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `calculate_contact_priority` –º–æ–¥—É–ª—è `config/regions.py`.

### –°–∏–º–ø—Ç–æ–º—ã
- –í—Å–µ 5 —Ç–µ—Å—Ç–æ–≤ –≤ `test_large_emails_replicate_20250127_0230.py` –∑–∞–≤–µ—Ä—à–∞–ª–∏—Å—å —Å –æ—à–∏–±–∫–æ–π
- –û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω–¥–µ–∫—Å—É [1] –≤ `region_info['level'].split()`
- –ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ—è–≤–ª—è–ª–∞—Å—å –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ, –∫–æ–≥–¥–∞ `business_context` –º–æ–≥ –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω

### –ü–µ—Ä–≤–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ None:** –§—É–Ω–∫—Ü–∏—è `calculate_contact_priority` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∞, —á—Ç–æ `business_context` –º–æ–∂–µ—Ç –±—ã—Ç—å `None`
2. **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:** –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ `business_context.get('region', '')` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–∞

### –í—Ç–æ—Ä–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
1. **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π split():** –ö–æ–¥ `region_info['level'].split()[1]` –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–ª, —á—Ç–æ –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –º–∏–Ω–∏–º—É–º 2 —ç–ª–µ–º–µ–Ω—Ç–∞
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ 'unknown' –∑–Ω–∞—á–µ–Ω–∏–π:** –ö–æ–≥–¥–∞ `region_info['level']` —Ä–∞–≤–µ–Ω 'unknown', split() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ business_context –Ω–∞ None
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏
if business_context is None:
    business_context = {}
```

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Ä–µ–≥–∏–æ–Ω–∞
```python
# –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ
# level_parts = region_info['level'].split()
# level = int(level_parts[1]) if len(level_parts) > 1 else 1

# –ù–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ
level_parts = region_info['level'].split()
if len(level_parts) > 1:
    try:
        level = int(level_parts[1])
    except (ValueError, IndexError):
        level = 1
else:
    level = 1
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚ùå –í—Å–µ 5 —Ç–µ—Å—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–∞–ª–∏—Å—å —Å –æ—à–∏–±–∫–æ–π "list index out of range"
- ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–ª–∞—Å—å –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –í—Å–µ 5 —Ç–µ—Å—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–∏—Å–µ–º —Ä–∞–∑–ª–∏—á–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞: –æ—Ç 1,234 –¥–æ 89,456 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: –æ—Ç 0 –¥–æ 3 –Ω–∞ –ø–∏—Å—å–º–æ
- ‚úÖ –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 0.01-0.02 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –ø–∏—Å—å–º–æ

### –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```
–¢–µ—Å—Ç 1: 1,234 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí 0 –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (0.01—Å)
–¢–µ—Å—Ç 2: 5,678 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí 1 –∫–æ–Ω—Ç–∞–∫—Ç (0.01—Å)
–¢–µ—Å—Ç 3: 12,345 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí 2 –∫–æ–Ω—Ç–∞–∫—Ç–∞ (0.02—Å)
–¢–µ—Å—Ç 4: 23,456 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí 3 –∫–æ–Ω—Ç–∞–∫—Ç–∞ (0.02—Å)
–¢–µ—Å—Ç 5: 89,456 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí 1 –∫–æ–Ω—Ç–∞–∫—Ç (0.02—Å)
```

## –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

1. **config/regions.py**
   - –§—É–Ω–∫—Ü–∏—è `calculate_contact_priority` (—Å—Ç—Ä–æ–∫–∏ ~50-70)
   - –§—É–Ω–∫—Ü–∏—è `calculate_region_priority` (—Å—Ç—Ä–æ–∫–∏ ~70-90)

2. **tests/test_large_emails_replicate_20250127_0230.py**
   - –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∏—Å—Ç–µ–º—É

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö –ø–∏—Å–µ–º
- ‚úÖ –ü–æ–≤—ã—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ —Å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

### –†–∏—Å–∫–∏
- üü° –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ: –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Å–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- üü° –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Ñ—É–Ω–∫—Ü–∏–∏ `calculate_contact_priority` –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ `business_context` —Ä–∞–≤–µ–Ω `None`
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –†–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –ø–∏—Å—å–º–∞–º–∏
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ "list index out of range" —É—Å–ø–µ—à–Ω–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞. –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –ø–∏—Å–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–ª–∞.

---
**–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** 2025-01-27 02:45:00 (UTC+07)  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** IMPLEMENT –∞–≥–µ–Ω—Ç  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤–ª–æ–∂–µ–Ω–∏–π

**–î–∞—Ç–∞:** 23 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–ú–æ–¥—É–ª—å:** `advanced_email_fetcher.py`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–ª–æ–∂–µ–Ω–∏–π  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –º–æ–¥—É–ª—è `google_sheets_exporter.py` –¥–ª—è –¥–∞—Ç—ã 7 –∏—é–ª—è 2025 –≥–æ–¥–∞ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∞—Å—å –ø—Ä–æ–±–ª–µ–º–∞:
- –í –ø–∞–ø–∫–µ `/Users/evgenyzach/contact_parser/data/emails/2025-07-07` –Ω–µ –±—ã–ª–æ –ø–∏—Å–µ–º
- –í –ø–∞–ø–∫–µ `/Users/evgenyzach/contact_parser/data/attachments/2025-07-07` —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –≤–ª–æ–∂–µ–Ω–∏—è
- –ú–æ–¥—É–ª—å `advanced_email_fetcher.py` –∑–∞–≥—Ä—É–∑–∏–ª –ø–∏—Å—å–º–∞ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å–∫–∞—á–∞–ª —Ç–µ –∂–µ –≤–ª–æ–∂–µ–Ω–∏—è
- –≠—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤ –≤–ª–æ–∂–µ–Ω–∏–π

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

–í –º–µ—Ç–æ–¥–µ `save_attachment_or_inline()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–ª–æ–∂–µ–Ω–∏–π:

```python
# üÜï –ü–†–û–í–ï–†–ö–ê –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –§–ê–ô–õ–û–í - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ñ–∞–π–ª—ã —Å —Ç–∞–∫–∏–º –∂–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º –≤ –ø–∞–ø–∫–µ
existing_files = list(attachments_date_dir.glob(f"*_{filename}"))
if existing_files:
    self.logger.info(f"üìÅ –§–ê–ô–õ –£–ñ–ï –°–£–©–ï–°–¢–í–£–ï–¢: {filename} - –Ω–∞–π–¥–µ–Ω–æ {len(existing_files)} —Ñ–∞–π–ª(–æ–≤)")
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ñ–∞–π–ª–µ
    existing_file = existing_files[0]
    file_size = existing_file.stat().st_size if existing_file.exists() else 0
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∫ –±—É–¥—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏
    if is_inline:
        self.stats['saved_inline_images'] += 1
    else:
        self.stats['saved_attachments'] += 1
    
    return {
        "original_filename": filename,
        "saved_filename": existing_file.name,
        "file_path": str(existing_file),
        "relative_path": f"attachments/{date_folder}/{existing_file.name}",
        "file_size": file_size,
        "file_type": SUPPORTED_ATTACHMENTS.get(Path(filename).suffix.lower(), 'unknown'),
        "content_type": content_type,
        "saved_at": self.get_local_time().isoformat(),
        "status": "already_exists",
        "is_inline": is_inline
    }
```

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è:** –ü–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ —Å —Ç–∞–∫–∏–º –∂–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º –≤ —Ü–µ–ª–µ–≤–æ–π –ø–∞–ø–∫–µ
2. **–ü–∞—Ç—Ç–µ—Ä–Ω –ø–æ–∏—Å–∫–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω `*_{filename}` –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤
3. **–í–æ–∑–≤—Ä–∞—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ:** –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ñ–∞–π–ª–µ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞
5. **–°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–∞:** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å `"already_exists"` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç 1: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è –¥–∞—Ç—ã 2025-07-07

**–ö–æ–º–∞–Ω–¥–∞:** `python src/advanced_email_fetcher.py --date 2025-07-07`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ú–æ–¥—É–ª—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏–ª –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∏—Å–µ–º –≤ –ø–∞–ø–∫–µ emails
- ‚úÖ –ù–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–ª–æ–∂–µ–Ω–∏–π
- ‚úÖ –§–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ attachments –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–∞–ª–∞ 0 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∏—Å–µ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ `/Users/evgenyzach/contact_parser/data/attachments/2025-07-07/`:**
```
-rw-r--r--@ 200980 Aug 23 23:39 20250707_dna-technology_ru_4d3e67c1_233953_attach_–ö–ü 7808 –æ—Ç 07.07.2025.pdf
-rw-r--r--@  82266 Aug 23 23:40 20250707_dna-technology_ru_acd24939_234008_inline_ghgq2FUQF40it72R.png
-rw-r--r--@ 200003 Aug 23 23:39 20250707_dna-technology_ru_b75c2989_233948_attach_–ö–ü 7808 –æ—Ç 07.07.2025.pdf
```

**–í—ã–≤–æ–¥:** –§–∞–π–ª—ã –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:** –ò—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
2. **–≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–æ–ø—Ä–∞–≤–¥–∞–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–ø–∫–∏ attachments
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:** –ò–∑–±–µ–≥–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫
4. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ—á–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
5. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ù–µ –Ω–∞—Ä—É—à–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏
6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–∞—Ö

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∏—Å—Ç–µ–º—É

- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –£–ª—É—á—à–µ–Ω–∞ –∑–∞ —Å—á–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ü–æ–≤—ã—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤–ª–æ–∂–µ–Ω–∏–π –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö –º–æ–¥—É–ª—è. –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –ø–∏—Å—å–º–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –∞ –≤–ª–æ–∂–µ–Ω–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—Å–µ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.
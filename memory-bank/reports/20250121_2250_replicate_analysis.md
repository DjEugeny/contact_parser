# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º Replicate –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-08-26 14:08:00 (UTC+07)  
**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤

**–õ–æ–∫–∞—Ü–∏—è:** `src/llm_extractor.py`, –º–µ—Ç–æ–¥ `extract_contacts()` (—Å—Ç—Ä–æ–∫–∞ 954)
- –ü–æ—Ä–æ–≥ —Ä–∞–∑–±–∏–≤–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 12000 —Å–∏–º–≤–æ–ª–æ–≤
- –ü—Ä–∏ —Ç–µ–∫—Å—Ç–µ 16665 —Å–∏–º–≤–æ–ª–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ —Ç—Ä–µ—Ç—å–µ–º –ø–∏—Å—å–º–µ
- –ú–µ—Ç–æ–¥ `_process_large_text()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç chunk_size=8000 —Å overlap=800

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç–µ–π

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏

**–õ–æ–∫–∞—Ü–∏—è:** `src/llm_extractor.py`, –º–µ—Ç–æ–¥ `_wait_for_replicate_result()` (—Å—Ç—Ä–æ–∫–∞ 597)
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π max_wait=300 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Timeout –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ = 30 —Å–µ–∫—É–Ω–¥
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ = 2 —Å–µ–∫—É–Ω–¥—ã

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Ç–∞–π–º–∞—É—Ç–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
- –í–æ–∑–º–æ–∂–Ω—ã–µ race conditions –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

### 3. –ü—Ä–æ–±–ª–µ–º—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON

**–õ–æ–∫–∞—Ü–∏—è:** `src/llm_extractor.py`, –º–µ—Ç–æ–¥ `_parse_llm_response()` (—Å—Ç—Ä–æ–∫–∞ 748)
- –ü—Ä–æ—Å—Ç–æ–π regex –ø–æ–∏—Å–∫ JSON: `r'\{.*\}'`
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö JSON
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ edge cases

**–ü—Ä–æ–±–ª–µ–º—ã:**
- Regex –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–π JSON
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—á–∏—Å—Ç–∫–∏ –º—É—Å–æ—Ä–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö JSON –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ

### 4. –ü—Ä–æ–±–ª–µ–º—ã retry –º–µ—Ö–∞–Ω–∏–∑–º–∞

**–õ–æ–∫–∞—Ü–∏—è:** `src/llm_extractor.py`, –º–µ—Ç–æ–¥ `_make_llm_request_with_retries()` (—Å—Ç—Ä–æ–∫–∞ 294)
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ max_retries=3
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ backoff
- –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–µ–∑ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É–º–Ω–æ–≥–æ retry –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
- –ù–µ—Ç –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ retry –ø–æ–¥ Replicate API

### 5. –ü—Ä–æ–±–ª–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ë–∞–∑–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ SSL, Connection, Timeout
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—ã—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ LLM (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤)
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ù–µ—Ç —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–Ω–æ–≥–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–ø—Ä–æ—Å–∞

## –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

### –ú–µ—Ç–æ–¥ extract_contacts() - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
```python
# –°—Ç—Ä–æ–∫–∞ 954: –ü–æ—Ä–æ–≥ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
if len(text) > 12000:
    print(f"   üìÑ –ë–æ–ª—å—à–æ–π —Ç–µ–∫—Å—Ç ({len(text)} —Å–∏–º–≤–æ–ª–æ–≤), —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞—Å—Ç–∏")
    return self._process_large_text(text, prompt, metadata)
```

### –ú–µ—Ç–æ–¥ _process_large_text() - —Ä–∞–∑–±–∏–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞
```python
# –°—Ç—Ä–æ–∫–∏ 804-806: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–∑–±–∏–≤–∫–∏
chunk_size = 8000   # –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
overlap = 800       # –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É–º–µ–Ω—å—à–µ–Ω–æ
```

### –ú–µ—Ç–æ–¥ _wait_for_replicate_result() - –æ–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```python
# –°—Ç—Ä–æ–∫–∞ 597: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç
def _wait_for_replicate_result(self, prediction_id: str, provider_config: dict, max_wait: int = 300)
```

### –ú–µ—Ç–æ–¥ _parse_llm_response() - –ø–∞—Ä—Å–∏–Ω–≥ JSON
```python
# –°—Ç—Ä–æ–∫–∞ 757: –ü—Ä–æ—Å—Ç–æ–π regex –ø–æ–∏—Å–∫
json_match = re.search(r'\{.*\}', response_text, re.DOTALL)
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
1. –°–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥ —Ä–∞–∑–±–∏–≤–∫–∏ —Å 12000 –¥–æ 10000 —Å–∏–º–≤–æ–ª–æ–≤
2. –£–º–µ–Ω—å—à–∏—Ç—å chunk_size —Å 8000 –¥–æ 6000 –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –£–ª—É—á—à–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã: –±–∞–∑–æ–≤—ã–π 300—Å + 30—Å –Ω–∞ –∫–∞–∂–¥—ã–µ 5000 —Å–∏–º–≤–æ–ª–æ–≤
2. –£–≤–µ–ª–∏—á–∏—Ç—å HTTP timeout —Å 30 –¥–æ 60 —Å–µ–∫—É–Ω–¥
3. –î–æ–±–∞–≤–∏—Ç—å graceful timeout handling

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
1. –£–ª—É—á—à–∏—Ç—å regex –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ JSON
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –æ—á–∏—Å—Ç–∫—É –æ—Ç–≤–µ—Ç–∞
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å fallback –ø–∞—Ä—Å–∏–Ω–≥

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –£–ª—É—á—à–µ–Ω–∏–µ retry –º–µ—Ö–∞–Ω–∏–∑–º–∞
1. –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff
2. –£–≤–µ–ª–∏—á–∏—Ç—å max_retries –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
3. –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –¥–ª—è —É–º–Ω–æ–≥–æ retry

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
2. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–¥–∞
2. üîÑ **–í –ø—Ä–æ—Ü–µ—Å—Å–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Replicate –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
3. ‚è≥ **–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
4. ‚è≥ **–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---
*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: 2025-01-21 22:50:00 (UTC+07)*
*–ê–≤—Ç–æ—Ä: IMPLEMENT Agent*